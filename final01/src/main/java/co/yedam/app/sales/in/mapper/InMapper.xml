<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.yedam.app.sales.in.mapper.InMapper">
	<!-- 전체조회 -->
	<select id="selectInAllList" resultType="InVO">
		SELECT i.prod_lot prod_lot
				, p.prod_name prod_name
				, i.sales_in_date sales_in_date
				, i.sales_in_amt sales_in_amt
				, i.prod_save_amt prod_save_amt
				, i.sales_in_exd sales_in_exd
		FROM sales_in i JOIN com_prod p
						ON (i.prod_code = p.prod_code)
		ORDER BY prod_lot DESC
	</select>

<!-- 검색 -->
  <select id="selectAllIn" resultType="InVO">
 		SELECT i.prod_lot prod_lot
				, p.prod_name prod_name
				, i.sales_in_date sales_in_date
				, i.sales_in_amt sales_in_amt
				, i.prod_save_amt prod_save_amt
				, i.sales_in_exd sales_in_exd
		FROM sales_in i JOIN com_prod p
						ON (i.prod_code = p.prod_code)
	<where>
			<if test="prodCode != null and prodCode != ''">
				AND p.prod_code LIKE '%' || #{prodCode} || '%'
			</if>
			<if test="startDate != null and startDate != ''">
            	AND i.sales_in_date <![CDATA[>=]]> TO_DATE(#{startDate}, 'YYYY-MM-DD')
         	</if>
         	<if test="endDate != null and endDate != ''">
           		AND i.sales_in_date <![CDATA[<=]]> TO_DATE(#{endDate}, 'YYYY-MM-DD')
         	</if>
	</where>					
	ORDER BY prod_lot DESC
	</select>
	
	<!-- 제품목록 -->
	<select id="selectProdAllList" resultType="InVO">
	SELECT prod_lot
			, prod_code
			, sales_in_date
			, sales_in_amt
			, prod_save_amt
			, sales_in_exd
			, emp_code 
	FROM sales_in
	ORDER BY prod_lot 
	</select>
	
	<!-- 입고관리 그리드 -->
	<select id="inMngList" resultType="InVO">
	SELECT prod_lot
			, prod_code
			, sales_in_date
			, sales_in_amt
			, prod_save_amt
			, sales_in_exd
			, emp_code
			, test_num
	FROM sales_in
	ORDER BY prod_lot
	</select>
	
	<!-- 검수완료된 완제품 목록  -->
	<select id="selectCProd" resultType="InVO">
	SELECT d.sales_ord_de_code, i.input_amt, i.err_amt, i.prcs_amt
	FROM sales_ord_de d LEFT JOIN prcs_ing i
                    		ON (d.prod_code = i.prod_code)
	WHERE d.sales_ord_de_code = (SELECT sales_ord_de_code 
	                             FROM sales_ord_de
	                             WHERE ord_code = (SELECT ord_code
	                                               FROM sales_ord
	                                               WHERE prcs_plan_code = (SELECT prcs_plan_code
	                                                                       FROM prcs_dir
	                                                                       WHERE prcs_dir_code = (SELECT prcs_dir_code
	                                                                                              FROM prcs_dir_de
	                                                                                              WHERE prcs_dir_de_code IN (SELECT prcs_dir_de_code
	                                                                                                                         FROM prcs_ing
	                                                                                                                         WHERE prcs_dir_ing_sts = 'S5'
	                                                                                                                         )))))
	</select>
	
	<!-- 등록 -->
	<insert id="insertProductIn" parameterType="InVO">
			INSERT INTO sales_in (
				prod_lot
				, prod_code
				, sales_in_date
				, sales_in_amt
				, prod_save_amt
				, sales_in_exd
				, emp_code
			) VALUES (
				get_primaryCode('prodLot')
				, #{prodCode}
				, #{salesInDate}
				, #{salesInAmt}
				, #{prodSaveAmt}
				, #{salesInExd}
				, #{empCode}
			)
	</insert>
	
	<!-- 수정 -->
	<update id="updateProductIn" parameterType="InVO">
			UPDATE sales_in
			SET sales_in_date = #{salesInDate}, sales_in_exd = #{salesInExd}
			WHERE prod_lot = #{podLot}
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteProductIn" parameterType="InVO">
			DELETE FROM sales_in
			WHERE prod_lot = #{prodLot}
		
	</delete>
	
 	<!-- 하단 그리드 행삭제시 상단 그리드 데이터 올리기용 --> 
<!-- 	<select id="selectDeletedTest" resultType="InVO"> -->
<!-- 		SELECT a.mat_test_code, d.mat_name, d.mat_unit, d.mat_std, c.mat_code, f.act_code, e.act_name, a.mat_od_de_cd, a.mat_amt, mat_yamt, mat_namt, a.err_code, b.commde_info err_info, mat_test_date -->
<!-- 		FROM mat_test a  -->
<!-- 		LEFT JOIN com_commde b -->
<!-- 			ON(a.err_code = b.commde_code) -->
<!-- 			LEFT JOIN mat_order_de c -->
<!-- 			ON(a.mat_od_de_cd = c.mat_od_de_cd) -->
<!-- 	        LEFT JOIN com_mat d -->
<!-- 	        ON(c.mat_code = d.mat_code) -->
<!-- 	        LEFT JOIN mat_order f -->
<!-- 	        ON(c.mat_od_cd = f.mat_od_cd) -->
<!-- 	        LEFT JOIN com_act e -->
<!-- 	        ON(f.act_code = e.act_code) -->
<!-- 		WHERE a.mat_test_code = #{matTestCode} -->
<!-- 	</select> -->
</mapper>