<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.yedam.app.material.in.mapper.MatInMapper">
	<!-- 전체조회 -->
	<select id="selectMatInList" resultType="MatInVO">
		SELECT a.mat_lot mat_lot, a.mat_code mat_code, b.mat_name mat_name, b.mat_unit, b.mat_std, c.act_name act_name, a.act_code, a.mat_in_amt mat_in_amt, a.mat_test_code, a.emp_code, d.emp_name emp_name, a.mat_ind mat_ind, a.mat_exd mat_exd 
		FROM mat_in a LEFT JOIN com_mat b
			ON(a.mat_code = b.mat_code)
				LEFT JOIN com_act c
					ON(a.act_code = c.act_code)
						LEFT JOIN com_emp d
							ON(a.emp_code = d.emp_code)
		ORDER BY a.mat_lot DESC
	</select>
	<!-- 검색 -->
	<select id="selectMatInSearch" resultType="MatInVO">
		SELECT a.mat_lot mat_lot, a.mat_code mat_code, b.mat_name mat_name, b.mat_unit, b.mat_std, c.act_name act_name, a.act_code, a.mat_in_amt mat_in_amt, a.mat_test_code, a.emp_code, d.emp_name emp_name, a.mat_ind mat_ind, a.mat_exd mat_exd
		FROM mat_in a LEFT JOIN com_mat b
			ON(a.mat_code = b.mat_code)
				LEFT JOIN com_act c
					ON(a.act_code = c.act_code)
						LEFT JOIN com_emp d
							ON(a.emp_code = d.emp_code)
		<where>
			<if test="materialCode != null and materialCode != ''">
				AND a.mat_code LIKE '%' || #{materialCode} || '%'
			</if>
			<if test="accountCode != null and accountCode != ''">
				AND a.act_code LIKE '%' || #{accountCode} || '%'
			</if>
			<if test="startDate != null and startDate != ''">
				AND TO_CHAR(a.mat_ind, 'YYYY-MM-DD') <![CDATA[>=]]> #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND TO_CHAR(a.mat_ind, 'YYYY-MM-DD') <![CDATA[<=]]> #{endDate}
			</if>
		</where>
		ORDER BY a.mat_lot DESC
	</select>
	
	<select id="selectMatTestFinishList" resultType="MatTestVO">
	<!-- 검수는 됐지만 입고 안된 자재들 목록-->
	SELECT a.mat_test_code, d.mat_name, d.mat_unit, d.mat_std, c.mat_code, f.act_code, e.act_name, a.mat_od_de_cd, mat_input_amt, mat_yamt, mat_namt, a.err_code, err_info, mat_test_date
	FROM mat_test a LEFT JOIN mat_in b
	ON(a.mat_test_code = b.mat_test_code)
	LEFT JOIN com_err b
		ON(a.err_code = b.err_code)
		LEFT JOIN mat_order_de c
		ON(a.mat_od_de_cd = c.mat_od_de_cd)
        LEFT JOIN com_mat d
        ON(c.mat_code = d.mat_code)
        LEFT JOIN mat_order f
        ON(c.mat_od_cd = f.mat_od_cd)
        LEFT JOIN com_act e
        ON(f.act_code = e.act_code)
	WHERE b.mat_test_code IS NULL
	ORDER BY mat_test_date DESC
	</select>
	
	<!-- 등록 -->
	<update id="insertMatIn" parameterType="MatInVO">
			INSERT INTO mat_in (
				MAT_LOT
				, MAT_CODE
				, MAT_IN_AMT
				, MAT_EXD
				, MAT_IND
				, EMP_CODE
				, MAT_TEST_CODE
				, ACT_CODE
				, MAT_STOCK
			) VALUES (
				get_primaryCode('matLot')
				, #{matCode}
				, #{matInAmt}
				, #{matExd}
				, #{matInd}
				, #{empCode}
				, #{matTestCode}
				, #{actCode}
				, #{matInAmt}
			)
	</update>
	
	<!-- 수정 -->
	<update id="updateMatIn" parameterType="MatInVO">
			UPDATE mat_in
			SET mat_ind = #{matInd}, mat_exd = #{matExd}
			WHERE mat_lot = #{matLot}
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteMatIn" parameterType="MatInVO">
		
			DELETE FROM mat_in
			WHERE mat_lot = #{matLot}
		
	</delete>
</mapper>