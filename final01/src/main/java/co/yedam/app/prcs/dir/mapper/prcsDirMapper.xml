<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.yedam.app.prcs.dir.mapper.PrcsDirMapper">
	<!-- 생산지시 조회 -->
	<select id="selectPrcsDirList" resultType="prcsDirVO">
		SELECT prcs_dir_code,
			   prcs_plan_code,
			   prcs_dir_name,
			   prcs_dir_date,
			   prcs_start_date,
			   prcs_end_date,
			   prcs_dir_sts,
			   emp_code
		  FROM prcs_dir
		 ORDER BY prcs_dir_code
	</select>
	
	<!-- 상세생산지시 조회 -->
	<select id="selectPrcsDirDeList" resultType="prcsDirVO">
		SELECT prcs_dir_de_code,
			   prcs_dir_code,
			   prod_code,
			   prcs_plan_amt,
			   prcs_dir_amt,
			   prcs_start_de_date,
			   prcs_end_de_date,
			   prcs_ing_sts,
			   emp_code
		  FROM prcs_dir_de
		 WHERE prcs_dir_code = #{prcsDirCode}
		 ORDER BY prcs_dir_de_code
	</select>
	
	<!-- 생산지시 등록 -->
	<insert id="insertPrcsDir" parameterType="prcsDirVO">
		<selectKey keyProperty="prcsDirCode" resultType="String" order="BEFORE">
			SELECT 'DIR-' || TO_CHAR(sysdate, 'rrMMdd') || LPAD(NVL(MAX(SUBSTR(prcs_dir_code, -3)),0) + 1, 3, '0')
			FROM prcs_dir
			WHERE SUBSTR(prcs_dir_code, 5, 6) = TO_CHAR(sysdate, 'rrMMdd')
		</selectKey>
		INSERT INTO prcs_dir (
								prcs_dir_code
								, prcs_plan_code
								, prcs_dir_name
								, prcs_start_date
								<if test="prcsEndDate != null">
								, prcs_end_date
								</if>
								, emp_code
							  )
			 VALUES (
						#{prcsDirCode}
						, #{prcsPlanCode}
						, #{prcsDirName}
						, #{prcsStartDate}
						<if test="prcsEndDate != null">
						, #{prcsEndDate}
						</if>
						, #{empCode}
					 )
	</insert>
	
	<!-- 상세생산지시 등록 -->
	<insert id="insertPrcsDirDe" parameterType="prcsDirVO">
		<selectKey keyProperty="prcsDirDeCode" resultType="String" order="BEFORE">
			SELECT 'DIRDE-' || TO_CHAR(sysdate, 'rrMMdd') || LPAD(NVL(MAX(SUBSTR(prcs_dir_de_code, -3)),0) + 1, 3, '0')
			FROM prcs_dir_de
			WHERE SUBSTR(prcs_dir_de_code, 7, 6) = TO_CHAR(sysdate, 'rrMMdd')
		</selectKey>
		INSERT INTO prcs_dir_de (
								prcs_dir_de_code
								, prcs_dir_code
							    , prod_code
							    , prcs_plan_amt
							    , prcs_dir_amt
							    , prcs_start_de_date
							    <if test="prcsEndDeDate != null">
							    , prcs_end_de_date
							    </if>
							    , emp_code
							  )
			 VALUES (
						#{prcsDirDeCode}
						, #{prcsDirCode}
						, #{prodCode}
						, #{prcsPlanAmt}
						, #{prcsDirAmt}
						, #{prcsStartDeDate}
						<if test="prcsEndDeDate != null">
						, #{prcsEndDeDate}
						</if>
						, #{empCode}
					 )
	</insert>
	
	<!-- 상세생산지시할때 해당 생산지시 코드 가져오기 -->

	
	<!-- 생산지시 수정 -->
	<update id="updatePrcsDir">
	</update>
	
</mapper>